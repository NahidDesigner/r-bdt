# StoreBuilder BD - Multi-Tenant E-Commerce Platform

A production-ready multi-tenant e-commerce platform for Bangladeshi traders with Cash on Delivery (COD) checkout, subdomain-based storefronts, shipping management, Facebook Pixel & Google Tag Manager integration, admin panel for platform management, and plan-based feature gating.

## Tech Stack

- **Frontend**: React 18 + TypeScript + Vite + TailwindCSS + shadcn/ui
- **Backend**: Express.js + TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: Session-based with bcrypt password hashing
- **Storage**: AWS S3 or Replit Object Storage
- **Routing**: wouter (client-side), Express (server-side)

## Features

- ✅ Multi-tenant architecture with subdomain-based stores
- ✅ Cash on Delivery checkout
- ✅ Product management with image uploads
- ✅ Order management and tracking
- ✅ Shipping management with location-based rates
- ✅ Facebook Pixel & Google Tag Manager integration
- ✅ Email notifications for new orders
- ✅ Custom domain support with admin verification
- ✅ Admin panel for platform management
- ✅ Plan-based feature gating

## Quick Start

### Prerequisites

- Node.js 18+ 
- PostgreSQL database
- AWS S3 bucket (or Replit storage for development)

### Installation

1. Clone the repository:
```bash
git clone <your-repo-url>
cd replit-bdt
```

2. Install dependencies:
```bash
npm install
```

3. Set up environment variables:
```bash
cp .env.example .env
# Edit .env with your configuration
```

4. Set up the database:
```bash
npm run db:push
```

5. Build the application:
```bash
npm run build
```

6. Start the server:
```bash
npm start
```

For development:
```bash
npm run dev
```

## Environment Variables

See `.env.example` for all available environment variables. Required variables:

- `SESSION_SECRET` - Random string for session encryption
- `DATABASE_URL` - PostgreSQL connection string
- `STORAGE_TYPE` - "s3" or "replit"
- `S3_BUCKET`, `S3_REGION`, `S3_ACCESS_KEY_ID`, `S3_SECRET_ACCESS_KEY` - If using S3

## Deployment on Coolify

### Prerequisites

1. A Coolify instance running
2. PostgreSQL database (can be provisioned in Coolify)
3. MinIO storage service (can be provisioned in Coolify)

### Deployment Steps

1. **Push your code to a Git repository** (GitHub, GitLab, etc.)

2. **In Coolify, create a new application:**
   - Click "New Resource" → "Application"
   - Connect your Git repository: `https://github.com/NahidDesigner/r-bdt`
   - Select the branch: `main`

3. **Configure Build Settings:**
   - Build Pack: **Nixpacks** (auto-detected)
   - Build Command: `npm run build` (auto-detected)
   - Start Command: `npm start` (auto-detected)

4. **Provision MinIO Storage in Coolify:**
   - In Coolify, go to "Resources" → "Storage" or "Services"
   - Create a new MinIO service
   - Note the connection details (endpoint, access key, secret key)
   - Create a bucket (e.g., `storebuilder-uploads`)

5. **Set Environment Variables:**
   Add all required variables in Coolify's environment section:
   ```
   SESSION_SECRET=<generate-random-string>
   DATABASE_URL=postgresql://user:pass@host:port/db
   STORAGE_TYPE=s3
   S3_ENDPOINT=http://minio.coolify.internal:9000
   S3_BUCKET=storebuilder-uploads
   S3_REGION=us-east-1
   S3_ACCESS_KEY_ID=<from-coolify-minio>
   S3_SECRET_ACCESS_KEY=<from-coolify-minio>
   S3_PUBLIC_URL=http://minio.coolify.internal:9000/storebuilder-uploads
   ```

6. **Deploy:**
   - Click "Deploy"
   - Wait for build to complete
   - Application will be available at the provided URL

### Using Coolify's MinIO Storage

Coolify provides MinIO (S3-compatible storage) as a built-in service. Here's how to set it up:

1. **Create MinIO Service in Coolify:**
   - Go to "Resources" → "Storage" or find "MinIO" in services
   - Click "Create" or "Add Service"
   - Coolify will provide:
     - **Endpoint**: Usually `http://minio.coolify.internal:9000` (internal) or a public URL
     - **Access Key**: Generated by Coolify
     - **Secret Key**: Generated by Coolify

2. **Create a Bucket:**
   - Access MinIO web interface (Coolify provides the URL)
   - Create a new bucket (e.g., `storebuilder-uploads`)
   - Set bucket policy to allow public read access (if needed)

3. **Configure Environment Variables:**
   ```
   STORAGE_TYPE=s3
   S3_ENDPOINT=http://minio.coolify.internal:9000
   S3_BUCKET=storebuilder-uploads
   S3_REGION=us-east-1
   S3_ACCESS_KEY_ID=<from-coolify-minio-service>
   S3_SECRET_ACCESS_KEY=<from-coolify-minio-service>
   S3_PUBLIC_URL=http://minio.coolify.internal:9000/storebuilder-uploads
   ```

**Note:** If MinIO is accessible publicly, use the public URL. If it's internal-only, you may need to proxy file serving through your app.

## Database Setup

The application uses Drizzle ORM with PostgreSQL. To push schema changes:

```bash
npm run db:push
```

## Project Structure

```
├── client/              # React frontend
│   ├── src/
│   │   ├── pages/      # Page components
│   │   ├── components/ # Reusable components
│   │   └── lib/        # Utilities and auth
├── server/             # Express backend
│   ├── routes.ts       # API routes
│   ├── storage.ts      # Database operations
│   └── replit_integrations/ # Storage adapters
├── shared/             # Shared types and schemas
│   └── schema.ts       # Database schema
└── script/            # Build scripts
```

## API Endpoints

- `POST /api/auth/register` - Register new tenant
- `POST /api/auth/login` - User login
- `GET /api/dashboard/stats` - Dashboard statistics
- `GET /api/products` - List products
- `POST /api/products` - Create product
- `GET /api/orders` - List orders
- `POST /api/store/:storeSlug/orders` - Create order (public)
- `GET /api/store/:storeSlug` - Get store data (public)

See `server/routes.ts` for complete API documentation.

## Development

```bash
# Run in development mode with hot reload
npm run dev

# Type check
npm run check

# Build for production
npm run build

# Run production build
npm start
```

## License

MIT

